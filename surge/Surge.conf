[General]
# --- 通用 ---
# > 增强版 Wi-Fi 助理
wifi-assist = false
# > 混合网络
all-hybrid = false
# > 游戏优化
udp-priority = true
# > 增强版 Wi-Fi 助理
internet-test-url = http://wifi.vivo.com.cn/generate_204
# > 代理测速 URL
proxy-test-url = http://1.1.1.1/generate_204
# > 测试超时（秒）
test-timeout = 5
# > 自定义 GeoIP 数据库
# geoip-maxmind-url = https://github.com/Hackl0us/GeoIP2-CN/raw/release/Country.mmdb
geoip-maxmind-url = https://raw.githubusercontent.com/Loyalsoldier/geoip/release/Country.mmdb
# > IPv6
ipv6 = false
# > IPv6 VIF
ipv6-vif = auto
# > 允许 Wi-Fi 访问
allow-wifi-access = false
# > 允许个人热点访问
allow-hotspot-access = false
# > ios HTTP 代理服务器端口
wifi-access-http-port = 6152
# > ios SOCKS5 代理服务器端口
wifi-access-socks5-port = 6153
# > mac HTTP 代理服务器端口
http-listen = 0.0.0.0:6152
# > mac SOCKS5 代理服务器端口
socks5-listen = 0.0.0.0:6153
# > 远程控制器
external-controller-access = chris@127.0.0.1:6170
# > HTTP API
http-api = chris@127.0.0.1:6171
# > HTTPS
http-api-tls = false
# > Web 控制器
http-api-web-dashboard = false
# > 兼容模式
compatibility-mode = 0
# > 跳过代理
skip-proxy = 127.0.0.1, 192.168.0.0/16, 10.0.0.0/8, 172.16.0.0/12, 100.64.0.0/10, localhost, *.local, seed-sequoia.siri.apple.com, sequoia.apple.com, passenger.t3go.cn, www.baidu.com, yunbusiness.ccb.com, wxh.wo.cn, gate.lagou.com, www.abchina.com.cn, mbank.psbc.com, www.10010.com
# > 排除简单主机名
exclude-simple-hostnames = true
# > 包含所有网络请求
include-all-networks = false
# > 包含本地网络请求
include-local-networks = false
# > UDP IP 防泄漏
# 如果没有代理服务器支持 UDP 转发，可修改为「 direct 」或注释下条，但需注意同一目标主机名 TCP 请求与 UDP 请求的源地址不同所造成的隐私及安全风险。
udp-policy-not-supported-behaviour = reject
# > 日志级别
loglevel = notify
# > 当遇到 REJECT 策略时返回错误页
show-error-page-for-reject = true
# > Always Real IP Hosts
always-real-ip = *.msftconnecttest.com, *.msftncsi.com, *.srv.nintendo.net, *.stun.playstation.net, xbox.*.microsoft.com, *.xboxlive.com, *.logon.battlenet.com.cn, *.logon.battle.net, stun.l.google.com
# > Hijack DNS
hijack-dns = *:53
# > TCP Force HTTP Hosts
# force-http-engine-hosts = example.com:80, <ip-address>:0
# > VIF Excluded Routes
# tun-excluded-routes = 239.255.255.250/32
# > VIF Included Routes
# tun-included-routes = 192.168.1.12/32
# > DNS 服务器
dns-server = 223.5.5.5, 119.29.29.29, 114.114.114.114, system
# > 加密的DNS服务器 (如无必要不建议使用)
encrypted-dns-server = https://223.5.5.5/dns-query, https://dns.alidns.com/dns-query
# 使加密 DNS 请求通过代理策略执行
# encrypted-dns-follow-outbound-mode = false
# > 关闭 DOH 的服务端证书验证
# encrypted-dns-skip-cert-verification = true
# > 从 /etc/hosts 中读取 DNS 记录
read-etc-hosts = true
# > 代理请求本地 DNS 映射
use-local-host-item-for-proxy = false
tls-provider = openssl

[Proxy Group]
Proxy = select, DIRECT, sub1, sub2
Streaming = select, Proxy, HK, TW, JP
StreamingSE = select, DIRECT, HK, TW
OpenAI = select, US
Apple = select, DIRECT, Proxy
Microsoft = select, DIRECT, Proxy
Google = select, US
AdBlock = select, REJECT, DIRECT
Final = select, Proxy, DIRECT
HK = select, policy-regex-filter=(🇭🇰)|(港)|(Hong)|(HK), no-alert=0, hidden=0, include-all-proxies=0, include-other-group="sub1, sub2"
TW = url-test, policy-regex-filter=(🇨🇳)|(台)|(Tai)|(TW), no-alert=0, hidden=0, include-all-proxies=0, include-other-group="sub1, sub2"
US = select, policy-regex-filter=(🇺🇸)|(美)|(States)|(US), no-alert=0, hidden=0, include-all-proxies=0, include-other-group="sub1, sub2"
JP = url-test, policy-regex-filter=(🇯🇵)|(日)|(Japan)|(JP), no-alert=0, hidden=0, include-all-proxies=0, include-other-group="sub1, sub2"
SG = url-test, policy-regex-filter=(🇸🇬)|(新)|(Singapore)|(SG), no-alert=0, hidden=0, include-all-proxies=0, include-other-group="sub1, sub2"
sub1 = select, policy-path=, update-interval=0, interval=600, timeout=3, no-alert=0, hidden=0, include-all-proxies=0
sub2 = select, policy-path=, update-interval=0, interval=600, timeout=3, no-alert=0, hidden=0, include-all-proxies=0

[Rule]
# > Safari 访问防跳转 App
DOMAIN,app-site-association.cdn-apple.com,REJECT
# > 绕过 App 企业证书过期
DOMAIN,ocsp.apple.com,REJECT
# > TestFlight 商店
DOMAIN,beta.apple.com,Proxy
DOMAIN,testflight.apple.com,Proxy
# > Boxjs 代理
DOMAIN-KEYWORD,jsdelivr.net,Proxy
# > Sub-Store 的 Web 页面
DOMAIN-SUFFIX,vercel.app,Proxy
# > Nexitally
DOMAIN-SUFFIX,myguyo.xyz,DIRECT
# > Tag
DOMAIN,tagcdnsub.work,DIRECT
# > Spotify
DOMAIN-SUFFIX,ap.spotify.com,DIRECT
# > Google
DOMAIN,mtalk.google.com,DIRECT
DOMAIN,mobile-gtalk.l.google.com,DIRECT
DOMAIN,alt1-mtalk.google.com,DIRECT
DOMAIN,alt2-mtalk.google.com,DIRECT
DOMAIN,alt3-mtalk.google.com,DIRECT
DOMAIN,alt4-mtalk.google.com,DIRECT
DOMAIN,alt5-mtalk.google.com,DIRECT
DOMAIN,alt6-mtalk.google.com,DIRECT
DOMAIN,alt7-mtalk.google.com,DIRECT
DOMAIN,alt8-mtalk.google.com,DIRECT
DOMAIN,alt9-mtalk.google.com,DIRECT
DOMAIN-SUFFIX,mobile-gtalk.l.google.com,DIRECT
# > HTTP3/QUIC 协议基于 UDP，部分地区 ISP 或线路 UDP 容易受到干扰或限速，屏蔽掉以阻止 HTTP 3 流量的 UDP 流量，强制回退到 TCP。
# > REJECT-NO-DROP 表示不使用默认的自动丢包逻辑，这样 Surge 每次都会返回 ICMP Port Unreachable，应用会立刻回退而不是等超时。
# > 阻止所有 UDP 流量进入443端口，使 HTTP3 请求回落到 TCP 流量。
AND,((PROTOCOL,UDP), (DEST-PORT,443)),REJECT-NO-DROP
# > Client
PROCESS-NAME,UUBooster,DIRECT
# > Download
PROCESS-NAME,aria2c,DIRECT
PROCESS-NAME,fdm,DIRECT
PROCESS-NAME,Folx,DIRECT
PROCESS-NAME,NetTransport,DIRECT
PROCESS-NAME,Thunder,DIRECT
PROCESS-NAME,Transmission,DIRECT
PROCESS-NAME,uTorrent,DIRECT
PROCESS-NAME,WebTorrent,DIRECT
PROCESS-NAME,WebTorrent Helper,DIRECT
# > External Resources Update
AND,((DOMAIN,raw.githubusercontent.com), (DOMAIN-SUFFIX,github.io), (USER-AGENT,Surge/*)),Proxy
# > 屏蔽 YouTube 的 UDP
AND,((PROTOCOL,UDP), (DOMAIN-SUFFIX,googlevideo.com), (DOMAIN-SUFFIX,gvt1.com)),REJECT-NO-DROP
# > 屏蔽 Instagram 的 UDP
AND,((PROTOCOL,UDP), (DOMAIN-SUFFIX,cdninstagram.com)),REJECT
# > Unbreak 后续规则修正
RULE-SET,https://raw.githubusercontent.com/DivineEngine/Profiles/master/Surge/Ruleset/Unbreak.list,DIRECT
# DOMAIN-SET,https://raw.githubusercontent.com/Loyalsoldier/surge-rules/release/private.txt,DIRECT
# > Advertising 广告
# RULE-SET,https://raw.githubusercontent.com/DivineEngine/Profiles/master/Surge/Ruleset/Guard/Advertising.list,AdBlock
# DOMAIN-SET,https://raw.githubusercontent.com/DivineEngine/Profiles/master/Surge/Ruleset/Guard/AdvertisingPlus.list,AdBlock
# DOMAIN-SET,https://raw.githubusercontent.com/Loyalsoldier/surge-rules/release/reject.txt,AdBlock
# > 广告终结
DOMAIN-SET,https://raw.githubusercontent.com/axcsz/Collect/master/Surge/Ruleset/Guard/fenliuAD.list,AdBlock
# DOMAIN-SET,https://raw.githubusercontent.com/privacy-protection-tools/anti-AD/master/anti-ad-surge2.txt,AdBlock
# > Privacy 隐私
# RULE-SET,https://raw.githubusercontent.com/DivineEngine/Profiles/master/Surge/Ruleset/Guard/Privacy.list,AdBlock
# > Hijacking 运营商劫持或恶意网站
RULE-SET,https://raw.githubusercontent.com/DivineEngine/Profiles/master/Surge/Ruleset/Guard/Hijacking.list,AdBlock
# RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Hijacking/Hijacking.list,AdBlock
# > system
RULE-SET,SYSTEM,DIRECT
# > Netflix
# RULE-SET,https://raw.githubusercontent.com/DivineEngine/Profiles/master/Surge/Ruleset/StreamingMedia/Video/Netflix.list,Streaming
# > Disney+
# RULE-SET,https://raw.githubusercontent.com/DivineEngine/Profiles/master/Surge/Ruleset/StreamingMedia/Video/DisneyPlus.list,Streaming
# > Yotube
# RULE-SET,https://github.com/DivineEngine/Profiles/blob/master/Surge/Ruleset/StreamingMedia/Music/YouTube-Music.list,Streaming
# RULE-SET,https://raw.githubusercontent.com/DivineEngine/Profiles/master/Surge/Ruleset/StreamingMedia/Video/YouTube.list,Streaming
# > Spotify
RULE-SET,https://raw.githubusercontent.com/DivineEngine/Profiles/master/Surge/Ruleset/StreamingMedia/Music/Spotify.list,Streaming
# > Bahamut
RULE-SET,https://raw.githubusercontent.com/DivineEngine/Profiles/master/Surge/Ruleset/StreamingMedia/Video/Bahamut.list,TW
# > Streaming 国际流媒体服务
RULE-SET,https://raw.githubusercontent.com/DivineEngine/Profiles/master/Surge/Ruleset/StreamingMedia/Streaming.list,Streaming
# > StreamingSE 中国流媒体服务（面向海外版本）
RULE-SET,https://raw.githubusercontent.com/DivineEngine/Profiles/master/Surge/Ruleset/StreamingMedia/StreamingSE.list,StreamingSE
# > OpenAI
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/OpenAI/OpenAI.list,OpenAI
# > GoogleVoice
# RULE-SET,https://raw.githubusercontent.com/DivineEngine/Profiles/master/Surge/Ruleset/Extra/Google/GoogleVoice.list,Google
# > Google
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Google/Google.list,Google
# > OneDrive
# RULE-SET,https://raw.githubusercontent.com/DivineEngine/Profiles/master/Surge/Ruleset/Extra/Microsoft/OneDrive.list,Proxy
# > Microsoft
# RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Microsoft/Microsoft.list,Microsoft
# > 阻止电报频繁请求
# AND,((PROCESS-NAME,Telegram), (OR,((IP-CIDR,0.0.0.0/8), (IP-CIDR,224.0.0.0/4)))),REJECT
# > Telegram
# RULE-SET,https://raw.githubusercontent.com/Loyalsoldier/surge-rules/release/telegramcidr.txt,Proxy
# RULE-SET,https://raw.githubusercontent.com/VirgilClyne/GetSomeFries/main/ruleset/ASN.Telegram.list,Proxy
# > 腾讯 WeChat ASN
# IP-ASN,132203,DIRECT,no-resolve
# > 腾讯 WeChat
# RULE-SET,https://raw.githubusercontent.com/DivineEngine/Profiles/master/Surge/Ruleset/Extra/WeChat.list,DIRECT
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/WeChat/WeChat.list,DIRECT
# > Apple
# RULE-SET,https://raw.githubusercontent.com/DivineEngine/Profiles/master/Surge/Ruleset/Extra/Apple/Apple.list,Apple
DOMAIN-SET,https://raw.githubusercontent.com/Loyalsoldier/surge-rules/release/icloud.txt,Apple
DOMAIN-SET,https://raw.githubusercontent.com/Loyalsoldier/surge-rules/release/apple.txt,Apple
# > Global 全球加速
# RULE-SET,https://raw.githubusercontent.com/DivineEngine/Profiles/master/Surge/Ruleset/Global.list,Proxy
DOMAIN-SET,https://raw.githubusercontent.com/Loyalsoldier/surge-rules/release/proxy.txt,Proxy
# > China 直连
# RULE-SET,https://raw.githubusercontent.com/DivineEngine/Profiles/master/Surge/Ruleset/China.list,DIRECT
# DOMAIN-SET,https://raw.githubusercontent.com/Loyalsoldier/surge-rules/release/direct.txt,DIRECT
# RULE-SET,https://raw.githubusercontent.com/Loyalsoldier/surge-rules/release/cncidr.txt,DIRECT
# > China ASN
RULE-SET,https://raw.githubusercontent.com/VirgilClyne/GetSomeFries/auto-update/ruleset/ASN.China.list,DIRECT
# > Surge 的自动 REJECT 保护丢包 防止应用循环请求
IP-CIDR,0.0.0.0/32,REJECT,no-resolve
# > 局域网
RULE-SET,LAN,DIRECT
# > GeoIP China
GEOIP,CN,DIRECT
# > DNS 查询失败走 Final 规则
FINAL,Final,dns-failed

[Host]
# > Firebase Cloud Messaging
mtalk.google.com = 108.177.125.188
# > Google Dl
dl.google.com = server:119.29.29.29
dl.l.google.com = server:119.29.29.29
update.googleapis.com = server:119.29.29.29
# > PlayStation
*.dl.playstation.net = server:119.29.29.29
# > 淘宝
*.taobao.com = server:223.5.5.5
# > 天猫
*.tmall.com = server:223.5.5.5
# > 阿里云
*.alicdn.com = server:223.5.5.5
*.aliyun.com = server:223.5.5.5
# > 腾迅
*.tencent.com = server:119.29.29.29
# > 腾讯QQ
*.qq.com = server:119.29.29.29
# > 微信
*.weixin.com = server:119.29.29.29
*.qpic.cn = server:119.29.29.29
# > 京东
*.jd.com = server:119.29.29.29
# > 哔哩哔喱
*.bilibili.com = server:119.29.29.29
hdslb.com = server:119.29.29.29
# > 网易
*.163.com = server:119.29.29.29
*.126.com = server:119.29.29.29
*.126.net = server:119.29.29.29
*.127.net = server:119.29.29.29
*.netease.com = server:119.29.29.29
# > 小米
*.mi.com = server:119.29.29.29
*.xiaomi.com = server:119.29.29.29
# > Router Admin Panel
# - Ubiquiti Amplifi Router
amplifi.lan = server:syslib
# - Synology Router
router.synology.com = server:syslib
# - Razer Sila Router
sila.razer.com = server:syslib
# - Asus Router
router.asus.com = server:syslib
# - Netgear Router
routerlogin.net = server:syslib
# - Netgear Obri Router
orbilogin.com = server:syslib
# - Linksys Router
www.LinksysSmartWiFi.com = server:syslib
# - Linksys Router
LinksysSmartWiFi.com = server:syslib
# - Linksys Router
myrouter.local = server:syslib
# - Xiaomi Mi WiFi Router
www.miwifi.com = server:syslib
# - Xiaomi Mi WiFi Router
miwifi.com = server:syslib
# - Huawei Router
mediarouter.home = server:syslib
# - TP-Link Router
tplogin.cn = server:syslib
# - TP-Link Router
tplinklogin.net = server:syslib
# - MERCURY Router
melogin.cn = server:syslib
# - FAST Router
falogin.cn = server:syslib
# > Apple
apple.com = server:223.5.5.5
*icloud.com = server:223.5.5.5
*icloud.com.cn = server:223.5.5.5
*testflight.apple.com = server:8.8.4.4

[Header Rewrite]
^https?:\/\/.*\.zhihu\.com\/(question|topic) header-replace User-Agent "osee2unifiedRelease/4432 osee2unifiedReleaseVersion/7.8.0 Mozilla/5.0 (iPhone; CPU iPhone OS 14_4 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mo    bile/15E148"

[SSID Setting]
TYPE:CELLULAR tfo-behaviour=force-disabled

[MITM]
skip-server-cert-verify = true
tcp-connection = true
h2 = true
ca-passphrase = 
ca-p12 = 

[Script]
# > Flush DNS, show the DNS delay and server.
flushDNS = type=generic,timeout=10,script-path=https://raw.githubusercontent.com/zZPiglet/Task/master/asset/flushDNS.js,argument=icon=wand.and.stars.inverse&color=#3d3d5b

[Panel]
flushDNS = script-name=flushDNS,update-interval=-1

